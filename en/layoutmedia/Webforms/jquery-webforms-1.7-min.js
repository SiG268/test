/*!
 *  Monday Webforms for FirstSpirit v1.7.5.FS5, (c) 2018 Monday Consulting GmbH
 *
 *  @see https://monday-webforms.com/
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"&&typeof require==="function"){a(require("jquery"))}else{a(jQuery)}}}(function($){(function(){function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent})();var EVENTS={AJAX_FINISHED:"mwf-ajax-finished",AJAX_ERROR:"mwf-ajax-error",FORM_REPLACED:"mwf-form-replaced",FILL_DROPDOWN:"mwf-fill-dropdown",FILL_SELECTION:"mwf-fill-selection",FILL_HIDDEN:"mwf-fill-hidden",SUGGESTION_SELECTED:"mwf-suggestion-selected"};function triggerEvent(el,eventName,options){var event;if(window.CustomEvent){event=new CustomEvent(eventName,options)}else{event=document.createEvent("CustomEvent");event.initCustomEvent(eventName,true,true,options)}el.dispatchEvent(event)}function Webforms(elem,settings){var plugin=this,$elem=$(elem),operators={},formdata={},defaults={appendUrlVars:false,operations:{},conditions:[],calculatedValues:[],fileuploadOptions:{},onConditionTrue:undefined,onConditionFalse:undefined,statisticsUrl:null},uiState={visible:{},hidden:{},writable:{},readonly:{},optional:{},mandatory:{},disabled:{},enabled:{}},stateMapping={visible:"hidden",hidden:"visible",writable:"readonly",readonly:"writable",optional:"mandatory",mandatory:"optional",disabled:"enabled",enabled:"disabled"},$form=$elem.is("form")?$elem:$elem.find("form"),formId=$form.data("mwf-id"),target=$form.data("mwf-target"),statisticsUrl=settings.statisticsUrl;if(!statisticsUrl||0===statisticsUrl.length){statisticsUrl=null}plugin.settings={};function updateUI(fields,conditionId,cond){var s,i,inverseState,isTrue,isFalse,state,input,conditionalFieldsState={visible:[],hidden:[],writable:[],readonly:[],optional:[],mandatory:[],enabled:[],disabled:[]};for(s in uiState){if(uiState.hasOwnProperty(s)){delete uiState[s][conditionId]}}for(i=0;i<fields.length;i++){input=fields[i].input;state=fields[i].state;if(cond){conditionalFieldsState[state].push(input)}uiState[state][conditionId]=conditionalFieldsState[state];inverseState=stateMapping[state];isTrue=containsState(state,input);isFalse=containsState(inverseState,input);if(isTrue){plugin.settings.operations[state]($form,fields[i]);if(plugin.settings.onConditionTrue!==undefined){plugin.settings.onConditionTrue($form,fields[i],state)}}else{if(isFalse||!isTrue){plugin.settings.operations[inverseState]($form,fields[i]);if(plugin.settings.onConditionFalse!==undefined){plugin.settings.onConditionFalse($form,fields[i],state)}}}}}function containsState(type,input){var state=uiState[type],cond;for(cond in state){if(state.hasOwnProperty(cond)&&$.inArray(input,state[cond])>-1){return true}}return false}function valueChanged($elem){formdata=serializeForm($form);$form.trigger("mwf-valuechange",$elem)}function serializeForm($form){var o={},a=$form.serializeArray(),name;$.each(a,function(){var $input=$form.find('[name="'+this.name+'"]'),value=this.value||"",key;if(value==="EMPTY_VALUE"){value=""}if($input.is(":radio")||$input.is(":checkbox")||$input.is("select")){if(!o.hasOwnProperty(this.name)){o[this.name]=[]}try{key=JSON.parse(value).k}catch(ex){}o[this.name].push((key!==undefined)?key:value)}else{if($input.is(":hidden")){try{key=JSON.parse(value).v}catch(ex){}o[this.name]=(key!==undefined)?key:value}else{o[this.name]=value}}});$form.find("input:checkbox:not(:checked),input:radio:not(:checked)").each(function(){name=$(this).attr("name");if(!o.hasOwnProperty(name)){o[name]=""}});return o}function maxSelected(array,max){var m=Number(max),l=(array!==null)?array.length:0;return(l<m)}function minSelected(array,min){var m=Number(min),l=(array!==null)?array.length:0;return(l>m)}function isSelected(array,s){return array!==null&&$.inArray(s,array)>-1}function parseAge(format,str){if(str===null){return null}var date=parseDate(format,str),today=new Date();return Math.floor((today-date)/(365.25*24*60*60*1000))}function parseDate(format,date){if(date===null){return null}return $.format.date(date,format)}function isEmptyList(array){var i,s;if(array!==null){for(i=0;i<array.length;i++){s=String(array[i]);if(s!==null&&s!==""&&s!=="EMPTY_VALUE"){return false}}}return true}function ajaxFillSelection($elem,attr,initial){var id=$elem.data("mwf-id"),data=$.extend(formdata,attr.data);if((attr.createEntry===undefined)){attr.createEntry=(attr.type==="checkbox")?plugin.settings.createCheckBox:plugin.settings.createRadio}if((attr.onFillSelection===undefined)){attr.onFillSelection=plugin.settings.onFillSelection}$.ajax({url:attr.url,type:"POST",data:data,cache:false}).done(function(json,textStatus,jqXHR){var pre=attr.preselected.split(","),i,entry;$elem.find("[data-mwf-container]").remove();for(i in json){if(json.hasOwnProperty(i)){entry=json[i];$elem.append(attr.createEntry($form,id,attr.name,entry,$.inArray(entry.k,pre)!==-1))}}if(initial){$elem.trigger("change")}attr.onFillSelection($form,$elem);triggerEvent(document,EVENTS.FILL_SELECTION,{detail:{$elem:$elem}})}).fail(function(jqXHR,textStatus,errorThrown){plugin.settings.onAjaxError(jqXHR,textStatus,errorThrown)})}function ajaxFillHidden($elem,attr,initial){var id=$elem.data("mwf-id"),data=$.extend(formdata,attr.data);$.ajax({url:attr.url,type:"POST",data:data,cache:false}).done(function(json,textStatus,jqXHR){$elem.val(JSON.stringify(json));$elem.attr("data-mwf-value",json.v);$elem.trigger("change");triggerEvent(document,EVENTS.FILL_HIDDEN,{detail:{$elem:$elem}})}).fail(function(jqXHR,textStatus,errorThrown){plugin.settings.onAjaxError(jqXHR,textStatus,errorThrown)})}function ajaxFillDropdown($elem,attr,initial){var data=$.extend(formdata,attr.data);if((attr.createOption===undefined)){attr.createOption=plugin.settings.createOption}if((attr.onFillDropdown===undefined)){attr.onFillDropdown=plugin.settings.onFillDropdown}$.ajax({url:attr.url,type:"POST",data:data,cache:false}).done(function(json,textStatus,jqXHR){var $option,i,entry,pre=attr.preselected.split(",");$elem.find("option[data-mwf-value]").remove();for(i in json){if(json.hasOwnProperty(i)){entry=json[i];$option=attr.createOption($form,entry,$.inArray(entry.k,pre)!==-1);$elem.append($option)}}if(initial){$elem.trigger("change")}attr.onFillDropdown($form,$elem);triggerEvent(document,EVENTS.FILL_DROPDOWN,{detail:{$elem:$elem}})}).fail(function(jqXHR,textStatus,errorThrown){plugin.settings.onAjaxError(jqXHR,textStatus,errorThrown)})}function ajaxAutocomplete($field,attr,opt){var chars=1;if(attr.params.chars!==undefined){chars=attr.params.chars}var onSelect=function(selection){triggerEvent(document,EVENTS.SUGGESTION_SELECTED,{detail:{field:$field,id:opt.formId,selection:selection,params:attr.params}});if($.isFunction(attr.onSelect)){attr.onSelect(arguments)}};$field.autocomplete({paramName:"query",params:attr.data,serviceUrl:attr.url,maxHeight:150,noCache:true,minChars:chars,type:"POST",onSelect:onSelect,autoSelectFirst:true,sendFormData:true,transformResult:function(response){response=JSON.parse(response);return{suggestions:$.map(response,function(entry,key){return{value:entry.v,data:entry.k}})}}})}function ajaxSubmit(opt){var $buttons=$form.find(":button").filter(":not(:disabled)"),data={_parentUrl:window.location.href};if(plugin.settings.appendUrlVars){$.extend(data,$.getUrlVars(window.location.search))}$.extend(data,$.getUrlVars(opt.query),$form.serializeObject());if(opt.onSubmit!==undefined){if(!opt.onSubmit($form,opt.url,opt.query)){return}}$buttons.prop("disabled",true);$.ajax({url:opt.url,type:"POST",data:data,traditional:true,cache:false}).done(function(data,textStatus,jqXHR){if(jqXHR&&jqXHR.getResponseHeader("webforms_redirect")){if(opt.onRedirect!==undefined){opt.onRedirect($form,data,textStatus,jqXHR)}var timeout=(jqXHR.getResponseHeader("webforms_redirect_delay")||0)*1000;setTimeout(function(){location.assign(jqXHR.getResponseHeader("webforms_redirect"))},timeout);if(!timeout){return}}$elem=$elem.replaceWithPush(data);$form=$elem.is("form")?$elem:$elem.find("form");if(opt.onSuccess!==undefined){opt.onSuccess($form,data,textStatus,jqXHR)}triggerEvent(document,EVENTS.AJAX_FINISHED,{detail:{id:opt.id}})}).fail(function(jqXHR,textStatus,errorThrown){if(opt.onError!==undefined){opt.onError($form,jqXHR,textStatus,errorThrown)}$buttons.prop("disabled",false);triggerEvent(document,EVENTS.AJAX_ERROR,{detail:{id:opt.id}})})}function createCondition(conditionId,conjunction,conditions,fields){var checkCondition=function(){var all=true,any=false,condTrue,i,formValue,cond;for(i=0;i<conditions.length;i++){cond=conditions[i];if(!cond){continue}formValue=formdata[cond[1]];if(formValue===undefined){formValue=cond[4]}condTrue=operators[cond[2]](formValue,cond[3]);if(condTrue){any=true}else{all=false}if(!conjunction&&any){break}}updateUI(fields,conditionId,(all||(!conjunction&&any)))};$form.on("mwf-valuechange",function(e,input){var cond,i;for(i=0;i<conditions.length;i++){cond=conditions[i];if(!cond){continue}if($(input).data("mwf-id")===conditions[i][0]){checkCondition()}}});checkCondition();if(plugin.settings.onConditionCreated!==undefined){plugin.settings.onConditionCreated($form,conditionId,conjunction,conditions,fields)}}function createCalculatedValue(calcValueId,js,fields,formVariables,updateValue){updateValue=(updateValue===undefined)?plugin.settings.updateCalculatedValue:updateValue;var $input,name,id=calcValueId,vars=formVariables,fct,calculate=function(){var state=$.extend({},fields,formdata,vars),result=fct(state),$field=$form.find('[data-mwf-id="'+id+'"]');updateValue($form,id,result);$field.val(result).trigger("change")};try{eval("fct = function(s) {"+js+"}")}catch(ex){$.logError(ex.message)}$form.on("mwf-valuechange",function(e,input){for(name in fields){if(fields.hasOwnProperty(name)&&$(input).attr("name")===name){calculate();break}}})}operators.contains=function(formValue,value){if(formValue===null||value===null){return false}return formValue.indexOf(value)!==-1};operators.containsnot=function(formValue,value){if(formValue===null||value===null){return false}return formValue.indexOf(value)===-1};operators.startswith=function(formValue,value){if(formValue===null||value===null){return false}return formValue.match(new RegExp("^"+value))==value};operators.endswith=function(formValue,value){if(formValue===null||value===null){return false}return formValue.match(new RegExp(value+"$"))==value};operators.equal=function(formValue,value){if(formValue===null||value===null){return formValue===value}var f1=parseFloat(formValue.replace(",",".")),f2=parseFloat(value.replace(",","."));return(!isNaN(f1)&&!isNaN(f2)&&f1===f2)||(formValue===value)};operators.notequal=function(formValue,value){if(formValue===null||value===null){return formValue!==value}var f1=parseFloat(formValue.replace(",",".")),f2=parseFloat(value.replace(",","."));return(!isNaN(f1)&&!isNaN(f2)&&f1!==f2)||(formValue!==value)};operators.empty=function(formValue,value){return formValue===null||formValue===""};operators.notempty=function(formValue,value){return formValue!==null&&formValue!==""};operators.emptylist=function(formValue,value){return isEmptyList(formValue)};operators.notemptylist=function(formValue,value){return !isEmptyList(formValue)};operators.selected=function(formValue,value){if(formValue===null||value===null){return false}return $.inArray(value,formValue)!==-1};operators.notselected=function(formValue,value){if(formValue===null||value===null){return false}return $.inArray(value,formValue)===-1};operators.minselected=function(formValue,value){var l=(formValue===null)?0:formValue.length;return l>Number(value)};operators.maxselected=function(formValue,value){var l=(formValue===null)?0:formValue.length;return l<Number(value)};operators.lessthan=function(formValue,value){if(formValue===null||value===null){return false}var f1=parseFloat(formValue.replace(",",".")),f2=parseFloat(value.replace(",","."));return(!isNaN(f1)&&!isNaN(f2)&&f1<f2)};operators.greaterthan=function(formValue,value){if(formValue===null||value===null){return false}var f1=parseFloat(formValue.replace(",",".")),f2=parseFloat(value.replace(",","."));return(!isNaN(f1)&&!isNaN(f2)&&f1>f2)};defaults.operations.visible=function($form,field){var $field=$form.find('[data-mwf-container="'+field.input+'"]');$field.removeAttr("disabled");$field.removeClass("mwf-hidden");var $formItem = $field.parent('.form-item');$formItem.removeClass('mwf-hidden');};defaults.operations.hidden=function($form,field){var $field=$form.find('[data-mwf-container="'+field.input+'"]');$field.attr("disabled","true");$field.addClass("mwf-hidden");var $formItem = $field.parent('.form-item');$formItem.addClass('mwf-hidden');};defaults.operations.writable=function($form,field){var $field=$form.find('[data-mwf-id="'+field.input+'"]');$field.removeAttr("readonly")};defaults.operations.readonly=function($form,field){var $field=$form.find('[data-mwf-id="'+field.input+'"]');$field.val(field.value);$field.attr("readonly","true")};defaults.operations.enabled=function($form,field){var $field=$form.find('[data-mwf-id="'+field.input+'"]');$field.removeAttr("disabled");$field.trigger("enable")};defaults.operations.disabled=function($form,field){var $field=$form.find('[data-mwf-id="'+field.input+'"]');$field.attr("disabled","true");$field.trigger("disable")};defaults.operations.optional=function($form,field){var $label=$form.find('label[for="'+field.input+'"]');$label.children("span.mwf-required").remove()};defaults.operations.mandatory=function($form,field){var $label=$form.find('label[for="'+field.input+'"]'),$span=$("<span></span>").attr("class","mwf-required").text("*");$label.children("span.mwf-required").remove();$label.append($span)};defaults.createOption=function($form,entry,selected){var $option=$("<option></option>");$option.attr("data-mwf-value",entry.k);$option.attr("value",JSON.stringify(entry)).append(entry.v);if(selected){$option.attr("selected",true)}return $option};defaults.createRadio=function($form,id,name,entry,checked){var $span,$input,$label,entryId=id+"_"+entry.k;$span=$("<span></span>").attr("class","mwf-option").attr("data-mwf-container",entryId);$input=$("<input/>").attr("type","radio").attr("id",entryId).attr("data-mwf-id",id).attr("data-mwf-value",entry.k).attr("value",JSON.stringify(entry)).attr("name",name).attr("class","mwf-radio");if(checked){$input.attr("checked","checked")}$label=$("<label></label>").attr("for",entryId).append(entry.v);$span.append($input);$span.append(" ");$span.append($label);return $span};defaults.createCheckBox=function($form,id,name,entry,checked){var $span,$input,$label,entryId=id+"_"+entry.k;$span=$("<span></span>").attr("class","mwf-option").attr("data-mwf-container",entryId);$input=$("<input/>").attr("type","checkbox").attr("id",entryId).attr("data-mwf-id",id).attr("data-mwf-value",entry.k).attr("value",JSON.stringify(entry)).attr("name",name).attr("class","mwf-checkbox");if(checked){$input.attr("checked","checked")}$label=$("<label></label>").attr("for",entryId).append(entry.v);$span.append($input);$span.append(" ");$span.append($label);return $span};defaults.createUploadFileRow=function($form,$attr,$file){var $row,$fileinfo,$meta,$preview,$ul,$name,$size,$buttons,$upload,$delete,$span,$progress,$error;$row=$("<div/>").attr("data-mwf-file","").attr("class","mwf-upload-row");$fileinfo=$("<div/>").attr("class","mwf-upload-fileinfo");$preview=$("<div/>").attr("data-mwf-file-preview","").attr("class","mwf-upload-preview");$meta=$("<div/>").attr("class","mwf-upload-metadata");$ul=$("<ul/>");$name=$("<li>").text($attr.labels.name+": "+$file.name);$size=$("<li>").text($attr.labels.size+": "+$.formatSize($file.size));$buttons=$("<div/>").attr("class"," mwf-upload-actions");$upload=$("<button>").attr("data-mwf-file-upload","").attr("class","mwf-upload-upload").text($attr.labels.upload);$delete=$("<button>").attr("data-mwf-file-delete","").attr("class","mwf-upload-delete").text($attr.labels.del);$span=$("<span>").css("width","0%");$progress=$("<div/>").attr("data-mwf-file-progress","").attr("class","mwf-upload-progressbar");$error=$("<div/>").attr("data-mwf-file-error","").attr("class","mwf-upload-error");$buttons.append($delete);if($attr.autoUpload===false){$buttons.append($upload)}$ul.append($name);$ul.append($size);$meta.append($ul);$fileinfo.append($preview);$fileinfo.append($meta);$progress.append($span);$row.append($fileinfo);$row.append($buttons);$row.append($error);$row.append($progress);return $row};defaults.createDownloadFileRow=function($form,$attr,$file){var $row,$fileinfo,$meta,$preview,$image,$ul,$name,$size,$buttons,$delete,$span,$error;$row=$("<div/>").attr("data-mwf-file","").attr("class","mwf-upload-row");$fileinfo=$("<div/>").attr("class","mwf-upload-fileinfo");$preview=$("<div/>").attr("data-mwf-preview","").attr("class","mwf-upload-preview");$meta=$("<div/>").attr("class","mwf-upload-metadata");$ul=$("<ul/>");$name=$("<li>").text($attr.labels.name+": "+$file.name);$size=$("<li>").text($attr.labels.size+": "+$.formatSize($file.size));$buttons=$("<div/>").attr("class"," mwf-upload-actions");$delete=$("<button>").attr("data-mwf-file-delete","").attr("class","mwf-upload-delete").text($attr.labels.del);$buttons.append($delete);$ul.append($name);$ul.append($size);$meta.append($ul);if($file.thumbnail_url){$image=$("<img/>").attr("src",$file.thumbnail_url);$preview.append($image)}$fileinfo.append($preview);$fileinfo.append($meta);$row.append($fileinfo);$row.append($buttons);if($file.error){$error=$("<div/>").attr("data-mwf-file-error","").attr("class","mwf-upload-error");$span=$("<span>").text($file.error);$error.append($span);$row.append($error)}return $row};defaults.updateCalculatedValue=function($form,id,value){$form.find('[data-mwf-value="'+id+'"]').text(value).html()};defaults.onAjaxError=function(jqXHR,status,error){$.logError(jqXHR.responseText)};defaults.onSubmit=function($form,url,query){return true};defaults.onConditionCreated=function($form,conditionId,conjunction,conditions,fields){};defaults.onFillDropdown=function($form,$select){};defaults.onFillSelection=function($form,$elem){};defaults.onInit=function($form){};plugin.formSubmit=function(opt){ajaxSubmit({url:target,id:formId,query:(opt.query!==undefined)?opt.query:"",onSubmit:(opt.submit!==undefined)?opt.submit:plugin.settings.onSubmit,onSuccess:(opt.success!==undefined)?opt.success:plugin.settings.onSuccess,onError:(opt.error!==undefined)?opt.error:plugin.settings.onAjaxError,onRedirect:(opt.redirect!==undefined)?opt.redirect:plugin.settings.onRedirect})};plugin.gotoPage=function(opt){ajaxSubmit({url:target,id:formId,query:opt.query.concat("&_target",opt.page,"=",opt.page),onSubmit:(opt.submit!==undefined)?opt.submit:plugin.settings.onSubmit,onSuccess:(opt.success!==undefined)?opt.success:plugin.settings.onSuccess,onError:(opt.error!==undefined)?opt.error:plugin.settings.onAjaxError,onRedirect:(opt.redirect!==undefined)?opt.redirect:plugin.settings.onRedirect})};plugin.init=function(){plugin.settings=$.extend(true,{},defaults,settings);formdata=serializeForm($form);$form.on("change",function(event){valueChanged($(event.target));if(statisticsUrl!==null){$.ajax({url:statisticsUrl});statisticsUrl=null}});if(target===undefined){$.logError("No target URL specified.")}$.each($form.find("[data-mwf-submit]"),function(){var attr=$(this).data("mwf-submit"),query=(attr.query!==undefined)?attr.query:"",onSuccess=(attr.success!==undefined)?attr.success:plugin.settings.onSuccess,onRedirect=(attr.redirect!==undefined)?attr.redirect:plugin.settings.onRedirect,onError=(attr.error!==undefined)?attr.error:plugin.settings.onAjaxError,onSubmit=(attr.submit!==undefined)?attr.submit:plugin.settings.onSubmit;switch(attr.type){case"next":case"back":case"goto":query=query.concat("&_target",attr.page,"=",attr.page);break;case"cancel":case"exit":case"finish":query=query.concat("&_",attr.type,"=1");break}$(this).on("click",function(){ajaxSubmit({url:target,id:formId,query:query,onSubmit:onSubmit,onSuccess:onSuccess,onError:onError,onRedirect:onRedirect})})});$.each($form.find("[data-mwf-fileupload]"),function(){var $upload=$(this),attr=$(this).data("mwf-fileupload"),$dropzone=$upload.find("[data-mwf-dropzone]"),$files=$upload.find("[data-mwf-files]"),$fileInput=$upload.find("input:file"),multiple=$fileInput.attr("multiple")!==undefined,useXhr=(!multiple&&$.support.xhrFileUpload)||$.support.xhrFormDataFileUpload,count=0,pendingList=[],enabled=true,$buttons=null;$upload.find("[data-mwf-file-upload-all]").on("click",function(){pendingList.forEach(function(data){data.submit()});pendingList=[]});$upload.find("[data-mwf-file-delete-all]").on("click",function(){$files.find("[data-mwf-file-delete]").trigger("click");pendingList=[]});$fileInput.on("disable",function(){enabled=false;$upload.fileupload("disable");$upload.addClass("mwf-upload-disabled");$upload.find(":button").prop("disabled",true)});$fileInput.on("enable",function(){enabled=true;$upload.fileupload("enable");$upload.removeClass("mwf-upload-disabled");$upload.find(":button").prop("disabled",false)});$dropzone.on("dragover",function(){if(enabled){$(this).addClass("mwf-upload-dragover")}});$dropzone.on("dragleave drop",function(){$(this).removeClass("mwf-upload-dragover")});$upload.fileupload({url:attr.url,paramName:attr.name,dataType:"json",dropZone:$dropzone,fileInput:$fileInput,previewMaxWidth:attr.previewMaxWidth,previewMaxHeight:attr.previewMaxHeight,previewCrop:true,maxNumberOfFiles:1,formData:{xhr:useXhr},add:function(e,data){var $this=$upload;if(!enabled){return false}if(multiple||count===0){count++}else{return false}pendingList.push(data);data.process(function(){return $this.fileupload("process",data)}).always(function(){$.each(data.files,function(index,file){var $row=plugin.settings.createUploadFileRow($form,attr,file);data.context=$row;$row.find("[data-mwf-file-upload]").data(data).on("click",function(){pendingList.splice($.inArray(data,pendingList),1);data.submit()});$row.find("[data-mwf-file-delete]").data(data).on("click",function(){$row.remove();pendingList.splice($.inArray(data,pendingList),1);count--});$row.find("[data-mwf-file-preview]").append(file.preview);$files.append($row)});if(attr.autoUpload===true){data.submit()}})},submit:function(e,data){if($buttons===null){$buttons=$form.find(":button").filter(":not(:disabled)");$buttons.prop("disabled",true)}},progress:function(e,data){var progress=parseInt(data.loaded/data.total*100,10);if(data.context){data.context.each(function(){data.context.find("[data-mwf-file-progress]").attr("aria-valuenow",progress).css("display","block").children().first().css("width",progress+"%").text(progress+"%")})}},done:function(e,data){var files=(typeof data.result==="string")?JSON.parse(data.result).files:data.result.files;$.each(files,function(index,file){var $row=plugin.settings.createDownloadFileRow($form,attr,file);if(data.context!==undefined){data.context.replaceWith($row)}else{$files.append($row)}if(file.error===undefined){$row.find("[data-mwf-file-delete]").on("click",function(){if(file.delete_url){$.ajax({url:file.delete_url})}$row.remove();pendingList.splice($.inArray(data,pendingList),1);count--})}else{$row.find("[data-mwf-file-delete]").on("click",function(){$row.remove();pendingList.splice($.inArray(data,pendingList),1);count--})}})},fail:function(e,data){$.each(data.files,function(index,file){var $row=plugin.settings.createDownloadFileRow($form,attr,{name:file.name,size:file.size,error:attr.labels.error});$row.find("[data-mwf-file-delete]").data(data).on("click",function(){$row.remove();pendingList.splice($.inArray(data,pendingList),1);count--});if(data.context!==undefined){data.context.replaceWith($row)}else{$files.append($row)}})},always:function(e,data){if($buttons!==null&&$upload.fileupload("active")===1){$buttons.prop("disabled",false);$buttons=null}}});$.ajax({url:attr.url,dataType:"json",data:{_name:attr.name,_do:"files"}}).done(function(result){$upload.fileupload("option","done").call($upload,$.Event("done"),{result:result});count=result.files.length})});$.each($form.find("[data-mwf-datasource]"),function(){var def={params:{},data:{}},attr=$.extend(true,{},def,$(this).data("mwf-datasource")),$elem=$(this);switch(attr.type){case"checkbox":case"radio":ajaxFillSelection($elem,attr,true);$form.on("mwf-valuechange",function(e,input){if($.trim(attr.params.dependsOn)){$.each(attr.params.dependsOn.split(","),function(i,v){if($(input).attr("name")===v){ajaxFillSelection($elem,attr,false);return false}})}});break;case"selection":ajaxFillDropdown($elem,attr,true);$form.on("mwf-valuechange",function(e,input){if($.trim(attr.params.dependsOn)){$.each(attr.params.dependsOn.split(","),function(i,v){if($(input).attr("name")===v){ajaxFillDropdown($elem,attr,false);return false}})}});break;case"suggestion":ajaxAutocomplete($elem,attr,{formId:formId});break;case"hidden":ajaxFillHidden($elem,attr,true);$form.on("mwf-valuechange",function(e,input){if($.trim(attr.params.dependsOn)){$.each(attr.params.dependsOn.split(","),function(i,v){if($(input).attr("name")===v){ajaxFillHidden($elem,attr,false);return false}})}});break;default:$.logError(attr.type===undefined?"Please specifiy the datasource type (checkbox, radio, selection or suggestion).":'Unknown datasource type "'.concat(attr.type,'".'))}});$.each(plugin.settings.conditions,function(){createCondition($(this).attr("id"),$(this).attr("conjunction"),$(this).attr("conditions"),$(this).attr("fields"))});$.each(plugin.settings.calculatedValues,function(){createCalculatedValue($(this).attr("id"),$(this).attr("js"),$(this).attr("fields"),$(this).attr("vars"))});plugin.settings.onInit($form)};plugin.init()}$.fn.webforms=function(options){var dataKey="webforms";return this.each(function(){var instance=$(this).data(dataKey);if(instance&&instance.dispose){instance.dispose()}instance=new Webforms(this,options);$(this).data(dataKey,instance)})};$.fn.replaceWithPush=function(elem){var $elem=$(elem);this.replaceWith($elem);return $elem};if(typeof $.fn.serializeObject==="undefined"){$.fn.serializeObject=function(){var o={},a=this.serializeArray();$.each(a,function(){if(o[this.name]!==undefined){if(!o[this.name].push){o[this.name]=[o[this.name]]}o[this.name].push(this.value||"")}else{o[this.name]=this.value||""}});return o}}if(typeof $.logError==="undefined"){$.extend({logError:function(msg){try{if(msg!==undefined&&typeof window.console!=="undefined"){console.error(msg)}}catch(ex){}}})}$.extend({mwfAjaxReplace:function(opt){var $dest=$(opt.selector),data={},optinId,s;if($dest.length>0){optinId=$.getOptinIdFromHash(opt.uid);s={url:null,type:"POST",appendUrlVars:false};if(optinId!==null){data._optinId=optinId;if(typeof history.replaceState!=="undefined"){history.replaceState({},document.title,window.location.pathname)}else{window.location.hash=""}$("html, body").animate({scrollTop:$dest.offset().top})}$.extend(s,opt);if(s.appendUrlVars){$.extend(data,$.getUrlVars(window.location.search))}$.extend(data,$.getUrlVars(s.query));$.ajax({url:s.url,type:s.type,data:data,traditional:true,cache:false}).done(function(data,textStatus,jqXHR){if(jqXHR&&jqXHR.getResponseHeader("webforms_redirect")){location.assign(jqXHR.getResponseHeader("webforms_redirect"));return}$dest.replaceWith(data);if(s.onSuccess!==undefined){s.onSuccess(data,textStatus,jqXHR)}triggerEvent(document,EVENTS.AJAX_FINISHED,{detail:{id:opt.id}})}).fail(function(jqXHR,textStatus,errorThrown){if(s.onError!==undefined){s.onError(jqXHR,textStatus,errorThrown)}else{$.logError(jqXHR.responseText)}triggerEvent(document,EVENTS.AJAX_ERROR,{detail:{id:opt.id}})})}},getUrlVars:function(url){var params={},i,param,pos,key,value,length;if(typeof url==="string"&&url.length>0){if(url[0]==="?"){url=url.substring(1)}url=url.split("&");for(i=0,length=url.length;i<length;i++){if(!url[i]||0===url[i].length){continue}param=url[i];pos=param.indexOf("=");if(pos>=0){key=param.substr(0,pos);value=param.substr(pos+1)}else{key=param;value=""}value=decodeURIComponent(value);if(params[key]===undefined){params[key]=value}else{if(params[key] instanceof Array){params[key].push(value)}else{params[key]=[params[key],value]}}}}return params},getUrlVar:function(url,name){return $.getUrlVars(url)[name]},getOptinIdFromHash:function(id){var hash=location.hash.replace("#",""),idx=hash.indexOf("mwf:"),optinId;if(idx!==-1){var elements=hash.split(":");if(elements.length===2||elements[1]===String(id)){return hash.substring(idx+4,hash.length)}}return null},formatSize:function(bytes){if(typeof bytes!=="number"){return""}if(bytes>=1000000000){return(bytes/1000000000).toFixed(2)+" GB"}if(bytes>=1000000){return(bytes/1000000).toFixed(2)+" MB"}return(bytes/1000).toFixed(2)+" KB"}})}));